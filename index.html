<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–¢–≤–æ–π Telegram Mini App ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏</title>
<style>
  body {
    background: #121212;
    color: #ddd;
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  .filters {
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }
  select, input[type="date"] {
    padding: 6px 10px;
    border-radius: 5px;
    border: none;
    background: #2c2c2c;
    color: #eee;
    cursor: pointer;
  }
  select option {
    background: #2c2c2c;
    color: #eee;
  }
  ul#task-list {
    list-style: none;
    padding: 0;
  }
  ul#task-list li {
    display: flex;
    gap: 15px;
    align-items: center;
    padding: 12px;
    border: 1px solid #333;
    border-radius: 8px;
    margin-bottom: 12px;
    background: #1e1e1e;
  }
  .task-field {
    padding: 6px 12px;
    border-radius: 6px;
    background: #272727;
    flex-grow: 1;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
  }
  .task-field:hover {
    background: #3a3a3a;
  }
  .task-status {
    width: 120px;
    text-align: center;
  }
  .task-date {
    width: 120px;
    text-align: center;
  }
  button.edit-btn, button.delete-btn {
    background: transparent;
    border: none;
    color: #888;
    font-size: 18px;
    cursor: pointer;
    transition: color 0.3s;
  }
  button.edit-btn:hover {
    color: #4caf50;
  }
  button.delete-btn:hover {
    color: #e74c3c;
  }
  /* –ú–æ–¥–∞–ª–∫–∞ */
  #modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right:0; bottom: 0;
    background: rgba(0,0,0,0.75);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #modal.active {
    display: flex;
  }
  #modal-content {
    background: #222;
    padding: 25px;
    border-radius: 12px;
    width: 320px;
    box-shadow: 0 0 15px #1db954;
  }
  #modal-content h2 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #1db954;
  }
  #modal-content label {
    display: block;
    margin-bottom: 6px;
    margin-top: 12px;
    color: #ccc;
  }
  #modal-content input[type="text"],
  #modal-content select,
  #modal-content input[type="date"] {
    width: 100%;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: #333;
    color: #eee;
    box-sizing: border-box;
  }
  #modal-content button {
    margin-top: 18px;
    padding: 10px 16px;
    background: #1db954;
    border: none;
    border-radius: 8px;
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    transition: background 0.3s;
  }
  #modal-content button:hover {
    background: #17a34a;
  }
  #modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    color: #ccc;
    font-size: 26px;
    cursor: pointer;
  }
  #add-task-btn {
    margin-bottom: 25px;
    padding: 10px 18px;
    background: #1db954;
    border: none;
    border-radius: 10px;
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }
  #add-task-btn:hover {
    background: #17a34a;
  }
</style>
</head>
<body>

<h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏</h1>

<div class="filters">
  <label>
    –°—Ç–∞—Ç—É—Å:
    <select id="filter-status">
      <option value="all">–í—Å–µ</option>
      <option value="–≤ –æ—á–µ—Ä–µ–¥–∏">–í –æ—á–µ—Ä–µ–¥–∏</option>
      <option value="–≤ —Ä–∞–±–æ—Ç–µ">–í —Ä–∞–±–æ—Ç–µ</option>
      <option value="–≤—ã–ø–æ–ª–Ω–µ–Ω–∞">–í—ã–ø–æ–ª–Ω–µ–Ω–∞</option>
    </select>
  </label>

  <label>
    –î–∞—Ç–∞ —Å:
    <input type="date" id="date-from" />
  </label>

  <label>
    –ø–æ:
    <input type="date" id="date-to" />
  </label>
</div>

<button id="add-task-btn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>

<ul id="task-list"></ul>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="modal">
  <div id="modal-content">
    <div id="modal-close">&times;</div>
    <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>

    <label for="modal-task-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
    <input type="text" id="modal-task-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –°–¥–µ–ª–∞—Ç—å –æ—Ç—á–µ—Ç" />

    <label for="modal-task-status">–°—Ç–∞—Ç—É—Å</label>
    <select id="modal-task-status">
      <option value="–≤ –æ—á–µ—Ä–µ–¥–∏">–í –æ—á–µ—Ä–µ–¥–∏</option>
      <option value="–≤ —Ä–∞–±–æ—Ç–µ">–í —Ä–∞–±–æ—Ç–µ</option>
      <option value="–≤—ã–ø–æ–ª–Ω–µ–Ω–∞">–í—ã–ø–æ–ª–Ω–µ–Ω–∞</option>
    </select>

    <label for="modal-task-date">–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
    <input type="date" id="modal-task-date" />

    <button id="modal-save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
  const tasks = [
    // –ü—Ä–∏–º–µ—Ä –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
    { text: "–°–¥–µ–ª–∞—Ç—å –æ—Ç—á–µ—Ç", status: "–≤ —Ä–∞–±–æ—Ç–µ", date: "2025-05-25" },
    { text: "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é", status: "–≤ –æ—á–µ—Ä–µ–¥–∏", date: "2025-05-24" },
    { text: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ", status: "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞", date: "2025-05-22" }
  ];

  const taskList = document.getElementById("task-list");
  const filterStatus = document.getElementById("filter-status");
  const dateFrom = document.getElementById("date-from");
  const dateTo = document.getElementById("date-to");
  const addTaskBtn = document.getElementById("add-task-btn");
  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modal-title");
  const modalClose = document.getElementById("modal-close");
  const modalTaskTitle = document.getElementById("modal-task-title");
  const modalTaskStatus = document.getElementById("modal-task-status");
  const modalTaskDate = document.getElementById("modal-task-date");
  const modalSaveBtn = document.getElementById("modal-save-btn");

  let editIndex = null; // –∏–Ω–¥–µ–∫—Å –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

  function renderTasks() {
    taskList.innerHTML = "";

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    const statusFilter = filterStatus.value;
    const fromDate = dateFrom.value;
    const toDate = dateTo.value;

    const filtered = tasks.filter(task => {
      let statusOk = statusFilter === "all" || task.status === statusFilter;
      let fromOk = !fromDate || (task.date && task.date >= fromDate);
      let toOk = !toDate || (task.date && task.date <= toDate);
      return statusOk && fromOk && toOk;
    });

    filtered.forEach((task, i) => {
      const li = document.createElement("li");

      // –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      const nameDiv = document.createElement("div");
      nameDiv.className = "task-field task-name";
      nameDiv.textContent = task.text;
      nameDiv.title = "–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è";
      nameDiv.onclick = () => openModal(i);
      li.appendChild(nameDiv);

      // –°—Ç–∞—Ç—É—Å ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π
      const statusDiv = document.createElement("div");
      statusDiv.className = "task-field task-status";
      statusDiv.textContent = task.status;
      statusDiv.title = "–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è";
      statusDiv.onclick = () => openModal(i);
      li.appendChild(statusDiv);

      // –î–∞—Ç–∞ ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è
      const dateDiv = document.createElement("div");
      dateDiv.className = "task-field task-date";
      dateDiv.textContent = task.date || "-";
      dateDiv.title = "–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è";
      dateDiv.onclick = () => openModal(i);
      li.appendChild(dateDiv);

      // –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –∫–Ω–æ–ø–∫–∏)
      const editBtn = document.createElement("button");
      editBtn.className = "edit-btn";
      editBtn.title = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É";
      editBtn.textContent = "‚úèÔ∏è";
      editBtn.onclick = () => openModal(i);
      li.appendChild(editBtn);

      // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
      const delBtn = document.createElement("button");
      delBtn.className = "delete-btn";
      delBtn.title = "–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É";
      delBtn.textContent = "üóëÔ∏è";
      delBtn.onclick = () => {
        if (confirm("–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?")) {
          tasks.splice(i, 1);
          renderTasks();
        }
      };
      li.appendChild(delBtn);

      taskList.appendChild(li);
    });
  }

  function openModal(index = null) {
    editIndex = index;
    if (index === null) {
      modalTitle.textContent = "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É";
      modalTaskTitle.value = "";
      modalTaskStatus.value = "–≤ –æ—á–µ—Ä–µ–¥–∏";
      modalTaskDate.value = "";
    } else {
      modalTitle.textContent = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É";
      const task = tasks[index];
      modalTaskTitle.value = task.text;
      modalTaskStatus.value = task.status;
      modalTaskDate.value = task.date || "";
    }
    modal.classList.add("active");
    modalTaskTitle.focus();
  }

  function closeModal() {
    modal.classList.remove("active");
  }

  modalClose.onclick = closeModal;

  modalSaveBtn.onclick = () => {
    const title = modalTaskTitle.value.trim();
    if (!title) {
      alert("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!");
      modalTaskTitle.focus();
      return;
    }
    const status = modalTaskStatus.value;
    const date = modalTaskDate.value;

    if (editIndex === null) {
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
      tasks.push({ text: title, status, date });
    } else {
      // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
      tasks[editIndex] = { text: title, status, date };
    }
    closeModal();
    renderTasks();
  };

  addTaskBtn.onclick = () => openModal();

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
  modal.onclick = e => {
    if (e.target === modal) closeModal();
  };

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  filterStatus.onchange = renderTasks;
  dateFrom.onchange = renderTasks;
  dateTo.onchange = renderTasks;

  renderTasks();
</script>

</body>
</html>
