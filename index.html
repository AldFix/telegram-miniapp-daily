<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω–∏–∫++</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      padding: 20px;
    }
    .card {
      background: #1f1f1f;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    h1 {
      font-size: 24px;
    }
    form {
      margin-top: 20px;
    }
    input[type="text"] {
      width: 70%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      margin-right: 10px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: #3a86ff;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    ul {
      margin-top: 20px;
      list-style: none;
      padding: 0;
    }
    li {
      padding: 8px 0;
      border-bottom: 1px solid #333;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="user-info">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram Mini App "–ï–∂–µ–¥–Ω–µ–≤–Ω–∏–∫++"!</p>

    <form id="task-form">
      <input type="text" id="task-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É" required />
      <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <ul id="task-list"></ul>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA_E4t3RHWLNtorKm9utOyyRwojkUsUmis",
      authDomain: "telegramminiappdaily.firebaseapp.com",
      databaseURL: "https://telegramminiappdaily-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "telegramminiappdaily",
      storageBucket: "telegramminiappdaily.appspot.com",
      messagingSenderId: "324821981446",
      appId: "1:324821981446:web:bad97b2c34a73087e2e687"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
    window.onload = () => {
      const user = window.Telegram.WebApp.initDataUnsafe?.user;
      document.getElementById("user-info").textContent =
        user ? `–ü—Ä–∏–≤–µ—Ç, ${user.first_name} üëã` : "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω";
      Telegram.WebApp.expand();
      loadTasks();
    };

    const taskForm = document.getElementById('task-form');
    const taskInput = document.getElementById('task-input');
    const taskList = document.getElementById('task-list');

    function addTask(taskText) {
      const taskId = Date.now().toString();
      set(ref(db, 'tasks/' + taskId), {
        text: taskText,
        done: false
      });
    }

    function loadTasks() {
      get(ref(db, 'tasks')).then(snapshot => {
        taskList.innerHTML = '';
        if (snapshot.exists()) {
          const tasks = snapshot.val();
          for (const id in tasks) {
            const task = tasks[id];
            const li = document.createElement('li');
            li.textContent = task.done ? `‚úÖ ${task.text}` : task.text;
            taskList.appendChild(li);
          }
        } else {
          taskList.textContent = '–ó–∞–¥–∞—á–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç';
        }
      });
    }

    taskForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = taskInput.value.trim();
      if (text) {
        addTask(text);
        taskInput.value = '';
        loadTasks();
      }
    });
  </script>
</body>
</html>

